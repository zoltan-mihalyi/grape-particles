<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<div id="game" style="width: 600px; height: 600px;">

</div>

<script src="lib/grape.js"></script>
<script src="grape-particles.js"></script>
<script>


    (function () {
        var flame = Grape.Particles.particle('circle', [
            {
                offset: 0,
                duration: [10, 30], //0 (1: max)
                size: 0, //2
                speed: [2, 4], //speedX:3, speedY:4
                direction: [85, 95],
                gravity: 0.05, //accX:5, accY:6
                gravityDirection: 270,
                r: 255, //7
                g: 40, //8
                b: 0, //9,
                a: 0.7
            },
            {
                offset: 15,
                size: 4
            },
            {
                offset: 70,
                r: 255,
                g: 165,
                b: 0
            },
            {
                offset: 100,
                size: 1,
                r: 90,
                g: 90,
                b: 90,
                a: 0
            }
        ]);

        var Fire = Grape.Class([Grape.Rectangle], {
            init: function () {
                this.width = 32;
                this.height = 64;
            },
            'event add': function () {
                this.emitter = this.getLayer().getSystem('particles').createEmitter({
                    x: this.x,
                    y: this.y + 48,
                    shape: 'ellipse',
                    width: 24,
                    height: 16,
                    duration: Infinity,
                    rate: 15,
                    particle: flame
                });
            },
            'event remove': function () {
                this.emitter.remove();
            }
        });

        var MouseFire = Grape.Class([Fire], {
            'global-event mouseMove': function (mouse) {
                this.x = this.emitter.x = mouse.x;
                this.y = this.emitter.y = mouse.y;
            }
        });


        var Scene = Grape.Scene.extend({
            init: function () {
                this.addSystem('particles', new Grape.Particles.ParticleSystem());
                var row = 0;
                var col = 0;
                for (var i = 0; i < 8; i++) {
                    this.add(new Fire({x: col * 128 + 64, y: row * 128 + 64}));
                    col++;
                    if (col > 3) {
                        row++;
                        col = 0;
                    }
                }
                this.add(new MouseFire({x: 300, y: 200}));
            },
            'event render': function (ctx) {
                ctx.fillStyle = 'black';
                ctx.fillText('Particles:'+this.getSystem('particles').particles.length, 20, 20);
            }
        });

        new Grape.Game({container: 'game'}).start(Scene);
    })();
</script>

</body>
</html>